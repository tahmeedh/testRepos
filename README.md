## Installation
To install:
```js script
nvm use
npm ci
```
If you are running playwright for the first time, you might also need to do
```js script
npx playwright install
```
## Setup Enviroment Variable
Create a .env file in the jsat-e2e-chat-window folder and fill in the enviroment variables. Don't push the .env file to the repo.
##
| Variable | Example | Description | 
| --- | --- | --- |
| `SERVER` | `SERVER='cpqa2-va1'` | Run test against this test enviroment|
| `ADMIN_USERNAME` | `ADMIN_USERNAME='slui@gr.net` | Email of a user with admin privileges|
| `ADMIN_PASSWORD` | `ADMIN_PASSWORD='PasswordOfSlui'` | Password of the above user|


## Run tests
Playwright commands : https://playwright.dev/docs/test-cli
##
| Example | Description | 
| --- | --- |
| SERVER=cpqa2-va1 npx playwright test | run all tests |
| SERVER=cpqa2-va1 npx playwright test C2596427 | run test with specific string in test file name |
| SERVER=cpqa2-va1 npx playwright test -g @smoke | run test with specific string in test title |
| SERVER=cpqa2-va1 npx playwright codegen | run playwright codegen |
| npx playwright show-report | run HTML Reporter |
##
| Flag | Description |
| --- | --- |
| `-g "abcd"` | Run the tests that contain the string "abcd" in test title |
| `--headed` | Run tests in headed browsers |
| `--repeat-each=5` | Run each test N times, defaults to one. |
| `--workers=1` | The maximum number of concurrent worker processes that run in parallel. | 
| `--ui` | -- Run tests in interactive UI mode, with a built-in watch mode (Preview) |

## Conventions

| Type | Example  | 
| --- | --- |
| Folder name | all lower case and kebab case |
| File name/Test name | kebab case |
| Variable | camel case |
| Constant | All upper case and snake case |

```
TestrailID-TestName(Test name should start with the chat typ(SUC/MUC/SMS/GroupText/WhatsApp/Channel))
C3674156-SMS-mini-vCard-is-displayed-when-hover-over-chat-header-avatar-in-invite.spec.ts

```
### For file that contain only 1 test
Use TestUtils to generate test name and test tags, this will reduce maintiance needed and eliminate files name and test name mismatch.
## TestUtil methods
| Method | Description |
| --- | --- |
| `testName` | Extract test name by file name |
| `testTag` | Generate tags according to folder structure e.g. test/sms/feed-view/footer/test.spec.ts will generate @sms @feed-view @footer|
| `testAnnoation` | Extract TestRail case ID from file name, and return an object that contains the annotation info. This will create a link to testrail on HTML report|
```
import { TestUtils } from 'Helpers/test-utils';
const { testAnnotation, testName, testTags } = TestUtils.getTestInfo(__filename);

```

### To use info generated by TestUtil
```
test(`${testName} ${testTags} @Mini-vCard @Mini-vCard-sanity`, async ({ page }) => {
    test.info().annotations.push(testAnnotation);
    ...
})

```

### Implemented features
| Feature | Create | Read | Update | Delete |
| --- | --- | --- | --- | --- |
| Company | ✅ | ✅ | ❌ | ✅ |
| Company directory settings | N/A | ✅ | ✅ | N/A |
| Roles | ✅ | ✅ | ✅ | ✅ |
| Groups | ❌ | ❌ | ❌ | ❌ |
| User | ✅ | ✅ | ✅  | ✅ |
| User Entitlements | ✅ | ✅ | ✅  | ✅ |
| Add user to Roster | ✅(add to roster) | ❌ | ✅(modify roster) | ✅(remove from roster) |
| Twilio Number | ✅ | ✅ | ✅  | ✅ |
| Bandwidth Number | ❌ | ✅ | ❌ | ❌ |
| WhatsApp Number | ✅ | ✅ | ✅  | ✅ |

### Mocking inbound Twilio and WhatsApp messages
Please see [READ-ME](./apis/scripts/README.md)

### API Docs
| API Name | URL |
| --- | --- |
| Message Core API | https://swaggerhub.globalrelay.net/apis/Internal-APIs/UC-core-api |
| MFS API | https://swaggerhub.globalrelay.net/apis/Internal-APIs/uc-message_fileshare_service-api |
| MDS API | https://swaggerhub.globalrelay.net/apis/Internal-APIs/UC-MDS-Admin-API/2.8 |
| Thrift APIs(SM) | https://stash.globalrelay.net/projects/THRIFT |
| GRCP | https://web1-msg-msgci1-nvan.dev-globalrelay.net/chirp-api/ |